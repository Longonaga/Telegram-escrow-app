<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>escrowaNG Marketplace</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f6f7fb;
      margin: 0;
      padding: 0;
    }

    header {
      background: linear-gradient(90deg, #0a932d, #fff, #0a932d);
      color: #000;
      text-align: center;
      padding: 15px 0;
      font-weight: bold;
      font-size: 1.4em;
    }

    .search-bar {
      display: flex;
      justify-content: center;
      margin: 20px;
      gap: 10px;
    }

    .search-bar input, .search-bar select {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      outline: none;
      width: 250px;
    }

    .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(270px, 1fr));
      gap: 20px;
      padding: 20px;
    }

    .product-card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      overflow: hidden;
      transition: transform 0.2s ease;
    }

    .product-card:hover {
      transform: scale(1.03);
    }

    .product-card img {
      width: 100%;
      height: 200px;
      object-fit: cover;
    }

    .product-info {
      padding: 15px;
    }

    .product-info h3 {
      margin: 0 0 10px;
      font-size: 1.1em;
      color: #0a932d;
    }

    .product-info p {
      font-size: 0.9em;
      color: #555;
      margin-bottom: 8px;
    }

    .price {
      color: #000;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .btn {
      display: inline-block;
      background: #0a932d;
      color: white;
      text-decoration: none;
      padding: 8px 12px;
      border-radius: 8px;
      transition: 0.3s ease;
    }

    .btn:hover {
      background: #066b21;
    }

    .floating-btn {
      position: fixed;
      bottom: 25px;
      right: 25px;
      background: #0a932d;
      color: white;
      border-radius: 50%;
      padding: 15px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      cursor: pointer;
      font-size: 20px;
    }

    .popup {
      display: none;
      position: fixed;
      bottom: 90px;
      right: 25px;
      background: white;
      border: 1px solid #ddd;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      padding: 15px;
      width: 250px;
    }

    .popup input {
      width: 100%;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      margin-bottom: 10px;
    }

    .popup button {
      background: #0a932d;
      border: none;
      color: white;
      padding: 8px 10px;
      border-radius: 6px;
      cursor: pointer;
    }

    footer {
      text-align: center;
      padding: 15px;
      font-size: 0.9em;
      background: #f1f1f1;
      margin-top: 20px;
      color: #333;
    }

    @media(max-width:600px){
      .search-bar {
        flex-direction: column;
        align-items: center;
      }
      .search-bar input, .search-bar select {
        width: 90%;
      }
    }
  </style>
</head>
<body>
  <header>escrowaNG Marketplace üõçÔ∏è</header>

  <div class="search-bar">
    <input type="text" id="searchInput" placeholder="Search products...">
    <select id="stateFilter">
      <option value="">All Locations</option>
    </select>
  </div>

  <div class="product-grid" id="productGrid"></div>

  <div class="floating-btn" id="notifyBtn" title="Get notified about products">
    <i class="fas fa-bell"></i>
  </div>

  <div class="popup" id="notifyPopup">
    <h4>Product Notification</h4>
    <input type="text" id="notifyKeyword" placeholder="Enter keyword...">
    <button onclick="subscribeNotification()">Subscribe</button>
  </div>

  <footer>¬© 2025 escrowaNG ‚Äî Nigeria's Secure Marketplace</footer>

  <script>
    const API_URL = "https://your-backend-api.com/api/products"; // replace later
    const stateSelect = document.getElementById("stateFilter");
    const productGrid = document.getElementById("productGrid");
    const searchInput = document.getElementById("searchInput");

    const states = [
      "Abia","Adamawa","Akwa Ibom","Anambra","Bauchi","Bayelsa","Benue","Borno","Cross River","Delta",
      "Ebonyi","Edo","Ekiti","Enugu","FCT","Gombe","Imo","Jigawa","Kaduna","Kano","Katsina","Kebbi",
      "Kogi","Kwara","Lagos","Nasarawa","Niger","Ogun","Ondo","Osun","Oyo","Plateau","Rivers","Sokoto",
      "Taraba","Yobe","Zamfara"
    ];
    states.forEach(s => {
      const opt = document.createElement("option");
      opt.value = s;
      opt.textContent = s;
      stateSelect.appendChild(opt);
    });

    async function fetchProducts() {
      try {
        const res = await fetch(API_URL);
        const products = await res.json();
        displayProducts(products);
      } catch (err) {
        console.error("Error fetching products:", err);
        productGrid.innerHTML = "<p style='text-align:center;'>‚ö†Ô∏è Unable to load products.</p>";
      }
    }

    function displayProducts(products) {
      const searchVal = searchInput.value.toLowerCase();
      const stateVal = stateSelect.value;
      const filtered = products.filter(p => {
        const matchesSearch = p.title.toLowerCase().includes(searchVal) || p.description.toLowerCase().includes(searchVal);
        const matchesState = stateVal ? p.location === stateVal : true;
        return matchesSearch && matchesState && p.status === "approved";
      });

      productGrid.innerHTML = filtered.length
        ? filtered.map(p => `
          <div class="product-card">
            <img src="${p.images?.[0] || 'https://via.placeholder.com/300x200?text=No+Image'}" alt="${p.title}">
            <div class="product-info">
              <h3>${p.title}</h3>
              <p>${p.description.slice(0, 60)}...</p>
              <p class="price">‚Ç¶${Number(p.price).toLocaleString()}</p>
              <p><strong>Location:</strong> ${p.location}</p>
              <a class="btn" href="tg://resolve?domain=escrowaNGbot&start=buy_${p._id}">Buy Now</a>
            </div>
          </div>
        `).join('')
        : "<p style='text-align:center;'>No products found.</p>";
    }

    searchInput.addEventListener("input", fetchProducts);
    stateSelect.addEventListener("change", fetchProducts);

    // Floating notification popup
    const notifyBtn = document.getElementById("notifyBtn");
    const notifyPopup = document.getElementById("notifyPopup");

    notifyBtn.addEventListener("click", () => {
      notifyPopup.style.display = notifyPopup.style.display === "block" ? "none" : "block";
    });

    function subscribeNotification() {
      const keyword = document.getElementById("notifyKeyword").value;
      if (!keyword.trim()) return alert("Enter a valid keyword.");
      alert(`You‚Äôll be notified when products matching "${keyword}" are listed.`);
      notifyPopup.style.display = "none";
      document.getElementById("notifyKeyword").value = "";
    }

    fetchProducts();
  </script>
</body>
</html>
